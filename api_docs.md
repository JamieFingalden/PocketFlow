# PocketFlow API æ–‡æ¡£ (å«æµ‹è¯•æ ‡æ³¨)

æœ¬æ–‡æ¡£è¯¦ç»†æè¿°äº† PocketFlow åç«¯ API çš„æ‰€æœ‰æ¥å£ï¼Œå¹¶åŒ…å«åŸºäºä»£ç é™æ€åˆ†æçš„æµ‹è¯•æ ‡æ³¨ã€‚

**åŸºç¡€ URL**: `/`

**é€šç”¨å“åº”æ ¼å¼**:

æ‰€æœ‰ API å“åº”éƒ½éµå¾ªä»¥ä¸‹æ ‡å‡†æ ¼å¼ï¼š

```json
{
  "code": 200,
  "message": "success",
  "data": {}
}
```

- `code`: HTTP çŠ¶æ€ç æˆ–è‡ªå®šä¹‰ä¸šåŠ¡ç ã€‚
- `message`: å¯¹å“åº”ç»“æœçš„æè¿°ã€‚
- `data`: å®é™…çš„å“åº”æ•°æ®ï¼Œå¯ä»¥æ˜¯å¯¹è±¡ã€æ•°ç»„æˆ– nullã€‚

---

## 1. å…¬å…±æ¥å£

è¿™äº›æ¥å£æ— éœ€ä»»ä½•è®¤è¯å³å¯è®¿é—®ã€‚

### 1.1. å¥åº·æ£€æŸ¥

æ£€æŸ¥æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œã€‚

- **URL**: `/health`
- **Method**: `GET`
- **è®¤è¯**: æ— 
- **æˆåŠŸå“åº”**:
  - **Code**: `200 OK`

### 1.2. OCR ç¥¨æ®è¯†åˆ«

- **URL**: `/ocr/process`
- **Method**: `POST`
- **è®¤è¯**: æ— 
- ğŸ“ **æ³¨æ„**: æ­¤æ¥å£å½“å‰ä¸ºå ä½ç¬¦ï¼Œæœªå®ç°å…·ä½“åŠŸèƒ½ã€‚ä»£ç ä¸­æ˜ç¡®æŒ‡å‡ºå®ƒåªæ˜¯ä¸€ä¸ªå ä½å“åº”ã€‚

### 1.3. API æ–‡æ¡£ (Swagger)

æä¾› Swagger UI ç•Œé¢æ¥æµè§ˆå’Œæµ‹è¯• APIã€‚

- **URL**: `/swagger/*any`
- **Method**: `GET`
- **è®¤è¯**: æ— 

---

## 2. è®¤è¯æ¥å£

### 2.1. ç”¨æˆ·æ³¨å†Œ

- **URL**: `/api/v1/register`
- **Method**: `POST`
- **è®¤è¯**: æ— 
- **è¯·æ±‚ä½“**: `{"username": "string", "password": "string", "email": "string"}`
- **æˆåŠŸå“åº”**: `200 OK` (è¿”å›åˆ›å»ºçš„ç”¨æˆ·ä¿¡æ¯)
- **é”™è¯¯å“åº”**: `400 Bad Request`, `500 Internal Server Error` (ä¾‹å¦‚ç”¨æˆ·åå·²å­˜åœ¨)

### 2.2. ç”¨æˆ·ç™»å½•

- **URL**: `/api/v1/login`
- **Method**: `POST`
- **è®¤è¯**: æ— 
- **è¯·æ±‚ä½“**: `{"username": "string", "password": "string"}`
- **æˆåŠŸå“åº”**: `200 OK` (è¿”å› JWT Token)
- **é”™è¯¯å“åº”**: `400 Bad Request`, `401 Unauthorized`

### 2.3. ç®¡ç†å‘˜ç™»å½•

- **URL**: `/api/v1/admin/login`
- **Method**: `POST`
- **è®¤è¯**: æ— 
- **è¯·æ±‚ä½“**: `{"username": "string", "password": "string"}`
- **æˆåŠŸå“åº”**: `200 OK` (è¿”å› JWT Token)
- **é”™è¯¯å“åº”**: `400 Bad Request`, `401 Unauthorized`

### 2.4. ç®¡ç†å‘˜ç™»å‡º

- **URL**: `/api/v1/admin/logout`
- **Method**: `POST`
- **è®¤è¯**: æ— 
- ğŸ“ **æ³¨æ„**: è¿™æ˜¯ä¸€ä¸ªæ— æ“ä½œæ¥å£ã€‚ä»£ç æ³¨é‡Šè¡¨æ˜ï¼Œç™»å‡ºé€»è¾‘ä¾èµ–å®¢æˆ·ç«¯åˆ é™¤ Tokenã€‚è¿™æ„å‘³ç€å³ä½¿ç”¨æˆ·è°ƒç”¨äº†ç™»å‡ºï¼Œå…¶ Token åœ¨è¿‡æœŸå‰ä¾ç„¶æœ‰æ•ˆã€‚å¯¹äºé«˜å®‰å…¨è¦æ±‚çš„åº”ç”¨ï¼ŒæœåŠ¡ç«¯åº”å®ç° Token é»‘åå•æœºåˆ¶ã€‚

---

## 3. ç”¨æˆ·æ¥å£ (éœ€ JWT è®¤è¯)

ä»¥ä¸‹æ‰€æœ‰æ¥å£éƒ½éœ€è¦åœ¨è¯·æ±‚å¤´ä¸­æºå¸¦ `Authorization: Bearer <token>`ã€‚

âš ï¸ **æ½œåœ¨å®‰å…¨é—®é¢˜ (IDOR)**: å¯¹äºæ‰€æœ‰é€šè¿‡ `:id` æ“ä½œèµ„æºçš„æ¥å£ (å¦‚ `GET /bills/:id`)ï¼Œåç«¯æœåŠ¡å±‚å¿…é¡»ä¸¥æ ¼æ ¡éªŒè¯¥èµ„æºæ˜¯å¦å±äºå½“å‰é€šè¿‡ JWT è®¤è¯çš„ç”¨æˆ·ã€‚å¦‚æœä»…é€šè¿‡ `id` æŸ¥è¯¢è€Œä¸å…³è” `user_id`ï¼Œä¼šå¯¼è‡´ç”¨æˆ·å¯ä»¥è¶Šæƒè®¿é—®æˆ–æ“ä½œå…¶ä»–ç”¨æˆ·çš„æ•°æ®ã€‚

### 3.1. è´¦å•ç®¡ç† (Bills)

#### 3.1.1. åˆ›å»ºè´¦å•

- **URL**: `/api/v1/bills`
- **Method**: `POST`
- **è¯·æ±‚ä½“**: `{"type": "string", "category_id": "int", "amount": "float", "remark": "string", "bill_time": "time"}`
- **æˆåŠŸå“åº”**: `200 OK` (è¿”å›åˆ›å»ºçš„è´¦å•å¯¹è±¡)

#### 3.1.2. è·å–å½“å‰ç”¨æˆ·çš„æ‰€æœ‰è´¦å•

- **URL**: `/api/v1/bills`
- **Method**: `GET`
- **æˆåŠŸå“åº”**: `200 OK` (è¿”å›è´¦å•å¯¹è±¡æ•°ç»„)
- âš ï¸ **æ½œåœ¨æ€§èƒ½é—®é¢˜**: æ­¤æ¥å£æ²¡æœ‰å®ç°åˆ†é¡µã€‚å¦‚æœå•ä¸ªç”¨æˆ·çš„è´¦å•æ•°é‡éå¸¸å¤šï¼Œä¸€æ¬¡æ€§è¿”å›æ‰€æœ‰æ•°æ®å¯èƒ½å¯¼è‡´æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯æ€§èƒ½é—®é¢˜ã€‚

#### 3.1.3. è·å–å•ä¸ªè´¦å•è¯¦æƒ…

- **URL**: `/api/v1/bills/:id`
- **Method**: `GET`
- **æˆåŠŸå“åº”**: `200 OK` (è¿”å›å•ä¸ªè´¦å•å¯¹è±¡)

#### 3.1.4. æ›´æ–°è´¦å•

- **URL**: `/api/v1/bills/:id`
- **Method**: `PUT`
- **è¯·æ±‚ä½“**: (ä¸åˆ›å»ºè´¦å•ç±»ä¼¼)
- **æˆåŠŸå“åº”**: `200 OK` (è¿”å›æ›´æ–°åçš„è´¦å•å¯¹è±¡)
- ğŸ“ **æ³¨æ„**: è¯·æ±‚ä½“ä¸­çš„ `user_id` å­—æ®µåº”è¢«å¿½ç•¥ã€‚æ›´æ–°æ“ä½œåº”ä»…ä¾èµ–äº JWT ä¸­çš„ `user_id` æ¥ç¡®å®šå½’å±ï¼Œé˜²æ­¢ç”¨æˆ·å°è¯•å°†è´¦å•ä¿®æ”¹åˆ°å…¶ä»–ç”¨æˆ·ä¸‹ã€‚

#### 3.1.5. åˆ é™¤è´¦å•

- **URL**: `/api/v1/bills/:id`
- **Method**: `DELETE`
- **æˆåŠŸå“åº”**: `200 OK`

### 3.2. ç»Ÿè®¡ (Statistics)

(æ‰€æœ‰ç»Ÿè®¡æ¥å£å‡éœ€è¦ `year` å’Œ `month` ä½œä¸º Query å‚æ•°)

#### 3.2.1. è·å–æœˆåº¦æ”¶æ”¯æ¦‚è§ˆ

- **URL**: `/api/v1/statistics/monthly-summary`
- **Method**: `GET`

#### 3.2.2. è·å–åˆ†ç±»ç»Ÿè®¡

- **URL**: `/api/v1/statistics/category`
- **Method**: `GET`
- **Query**: `type=income|expense`

#### 3.2.3. è·å–æ¯æ—¥æ”¶æ”¯ç»Ÿè®¡

- **URL**: `/api/v1/statistics/daily`
- **Method**: `GET`

#### 3.2.4. è·å–å¹´åº¦æœˆåº¦å›¾è¡¨ç»Ÿè®¡

- **URL**: `/api/v1/statistics/monthly-chart`
- **Method**: `GET`
- **Query**: `year`

---

## 4. ç®¡ç†å‘˜æ¥å£ (éœ€ Admin è®¤è¯)

ä»¥ä¸‹æ¥å£éœ€è¦ç®¡ç†å‘˜æƒé™çš„ JWT Tokenã€‚

### 4.1. ç”¨æˆ·ç®¡ç† (Users)

#### 4.1.1. è·å–ç”¨æˆ·åˆ—è¡¨ (åˆ†é¡µ)

- **URL**: `/api/v1/admin/users`
- **Method**: `GET`
- **Query**: `page`, `page_size`

#### 4.1.2. è·å–å•ä¸ªç”¨æˆ·ä¿¡æ¯

- **URL**: `/api/v1/admin/users/:id`
- **Method**: `GET`

#### 4.1.3. æ›´æ–°ç”¨æˆ·ä¿¡æ¯

- **URL**: `/api/v1/admin/users/:id`
- **Method**: `PUT`
- âš ï¸ **æ½œåœ¨é—®é¢˜**: æ­¤æ¥å£ç›´æ¥å°†è¯·æ±‚ä½“ç»‘å®šåˆ° `models.User` ç»“æ„ã€‚è¿™æ„å‘³ç€ç®¡ç†å‘˜å¯ä»¥æ›´æ–°åŒ…æ‹¬ `role`, `enabled` åœ¨å†…çš„æ‰€æœ‰å­—æ®µã€‚è¿™ç§å®½æ³›çš„ç»‘å®šå¯èƒ½å¸¦æ¥æ„æƒ³ä¸åˆ°çš„å‰¯ä½œç”¨ï¼Œå»ºè®®ä½¿ç”¨ä¸“é—¨çš„ `UpdateUserDTO` å¯¹è±¡ï¼Œåªæš´éœ²å…è®¸ç®¡ç†å‘˜ä¿®æ”¹çš„å­—æ®µã€‚

#### 4.1.4. ç¦ç”¨ç”¨æˆ·

- **URL**: `/api/v1/admin/users/:id/disable`
- **Method**: `PUT`

#### 4.1.5. å¯ç”¨ç”¨æˆ·

- **URL**: `/api/v1/admin/users/:id/enable`
- **Method**: `PUT`

### 4.2. è´¦å•ç®¡ç† (Bills)

#### 4.2.1. è·å–æ‰€æœ‰è´¦å• (åˆ†é¡µ)

- **URL**: `/api/v1/admin/bills`
- **Method**: `GET`
- **Query**: `page`, `page_size`, `user_id` (å¯é€‰)

#### 4.2.2. è·å–ä»»æ„è´¦å•è¯¦æƒ…

- **URL**: `/api/v1/admin/bills/:id`
- **Method**: `GET`

#### 4.2.3. æ›´æ–°ä»»æ„è´¦å•

- **URL**: `/api/v1/admin/bills/:id`
- **Method**: `PUT`

#### 4.2.4. åˆ é™¤ä»»æ„è´¦å•

- **URL**: `/api/v1/admin/bills/:id`
- **Method**: `DELETE`

### 4.3. ç»Ÿè®¡ç®¡ç† (Statistics)

#### 4.3.1. è·å–ç³»ç»Ÿæ•´ä½“ç»Ÿè®¡

- **URL**: `/api/v1/admin/statistics/system`
- **Method**: `GET`

#### 4.3.2. è·å–ç”¨æˆ·ç»Ÿè®¡ (åˆ†é¡µ)

- **URL**: `/api/v1/admin/statistics/users`
- **Method**: `GET`
- **Query**: `page`, `page_size`

#### 4.3.3. è·å–è´¦å•ç»Ÿè®¡

- **URL**: `/api/v1/admin/statistics/bills`
- **Method**: `GET`
- **Query**: `year` (å¯é€‰), `month` (å¯é€‰)